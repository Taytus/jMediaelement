<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<title>Audioplayer Demo</title>
		<link class="ui-theme" rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/themes/sunny/jquery-ui.css"/>
		<link rel="stylesheet" href="../css/styles.css" />
		<link rel="stylesheet" href="player-style-simple-controls.css" />
		
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		
		<!-- ui-components -->
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js"></script>
		<!-- END:  ui-components -->
		<!-- for a11y-slider -->
		<script src="../plugins/utils/a11y-slider.ext.js"></script>
		<!-- END: for a11y-slider -->
		
		<script src="../packages/mm.full.js"></script>
		
		<script>
			$('html').addClass('js-on');
			function MMPlaylist(wrapper, opts){
				this.init(wrapper, opts);
			}
			MMPlaylist.prototype = {
				init: function(wrapper, opts){
					var that = this;
					this.wrapper = wrapper;
					$('div.player-errors', wrapper).empty();
					//autoplay, loop, src, poster autobuffer are normalized + there are two special attributes 'srces' and 'getConfig'
					this.player = $('audio', wrapper).attr({autoplay: true});
					this.playList = $('div.playlist', wrapper).sortable({ items: 'li.playlist-item' });
					
					this.playList
						.delegate('li.playlist-item', 'click', function(){
							that.loadItem(this);
							return false;
						})
					;
					this.player
						// the totalerror event is fired if no element can play the source
						.bind('totalerror', function(){
							$('div.player-errors', wrapper).html('an media error has occured').show();
						})
						.bind('ended', function(){
							var list 		= $('li.playlist-item', that.playList),
								curIndex 	= list.index( list.filter('.ui-state-active') )
							;
							that.loadIndex( (list.length <= curIndex + 1) ? 0 : curIndex + 1);
						})
					;
					
					//init mediaelement api
					wrapper.jmeControl(opts);
					//and load the first item
					this.player.jmeReady(function(){
						that.loadIndex(0);
					});
				},
				loadItem: function(item){
					this.loadIndex($('li.playlist-item', this.playList).index(item));
				},
				loadIndex: function(index){
					var item = $('li.playlist-item', this.playList)
						.removeClass('ui-state-active')
						.filter(':eq('+ index +')')
						.addClass('ui-state-active')
					;
					this.player.loadSrc( this.getItemSrces( item )  );
				},
				getItemSrces: function(item){
					var srces = [];
					$('.src a', item).each(function(){
						srces.push(this.href);
					});
					return srces;
				}
			};
			$(function(){
				$('html').addClass('js-ready');
				new MMPlaylist($('div.ui-media-player'), {
							embed: {
								removeControls: true,
								jwPlayer: {
									path: '../mediaplayers/jw-player/player.swf'
								}
							}
						})
					;
			});
			
		</script>
	</head>
	<body>
		
		
		<div class="ui-media-player">
			<div class="player-errors ui-state-error">
				Turn on your JavaScript
			</div>
			<audio></audio>
			
			<div class="media-controls ui-widget ui-widget-header ui-corner-all">
				<a class="play-pause"><span class="ui-icon ui-icon-play"> </span><span class="button-text">play / pause</span></a>
				<div class="timeline-slider">
					<span class="ui-handle-label">play position</span>
					<div class="progressbar"></div>
				</div>
				<a class="mute-unmute"><span class="ui-icon ui-icon-volume-on"> </span><span class="button-text">mute / unmute</span></a>
				<div class="volume-slider"><span class="ui-handle-label">volume control</span></div>
			</div>
			
			<div class="playlist ui-widget ui-widget-header ui-corner-all">
				<ul>
					<li class="playlist-item ui-state-default ui-widget-content ui-corner-all">
						<a href="#">swazzrokk</a>
						<ul class="src">
							<li><a class="source" href="media/swazzrokk_v1.mp3">swazzrokk im mp3 format</a></li>
						</ul>
					</li>
					<li class="playlist-item ui-state-default ui-widget-content ui-corner-all">
						<a href="#">anc</a>
						<ul class="src">
							<li><a class="source" href="media/ANC_sketchV2n.mp3">anc im mp3 format</a></li>
						</ul>
					</li>
					<li class="playlist-item ui-state-default ui-widget-content ui-corner-all">
						<a href="#">chefsache</a>
						<ul class="src">
							<li><a class="source" href="media/chefsachesketch.mp3">anc im mp3 format</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
		<p>(c) copyright BaszT | <a href="#">#</a></p>
	</body>
</html>
